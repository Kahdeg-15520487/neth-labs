using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using Nethereum.Hex.HexTypes;
using Nethereum.RPC.Eth.DTOs;
using Nethereum.ABI.FunctionEncoding.Attributes;
using Xunit;
using Nethereum.Web3.Accounts.Managed;

namespace Nethereum.Tutorials
{
    public class ShouldGetCertifierContract
    {
        
        public async Task ShouldBeAbleGetCertifierContractTask()
        {
            var senderAddress = "0x3d9bd851f0ad69bc206d4ffd362f6b956a95f387";
            var contractAddress = "0xC6de945186b6244a7623d27D2017CF00bae18F85";
            var password = "aaa";

            var abi =
                @"[{""constant"":false,""inputs"":[{""name"":""_GlobalAdmin"",""type"":""address""}],""name"":""changeGlobalAdmin"",""outputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""function""},{""constant"":false,""inputs"":[{""name"":""_CertAdmin"",""type"":""address""}],""name"":""addCertAdmin"",""outputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""function""},{""constant"":true,""inputs"":[{""name"":""_CertID"",""type"":""string""}],""name"":""getCertKey"",""outputs"":[{""name"":"""",""type"":""bytes32""}],""payable"":false,""stateMutability"":""pure"",""type"":""function""},{""constant"":true,""inputs"":[{""name"":""_CertID"",""type"":""string""}],""name"":""getCertAddressByID"",""outputs"":[{""name"":"""",""type"":""address""}],""payable"":false,""stateMutability"":""view"",""type"":""function""},{""constant"":true,""inputs"":[{""name"":"""",""type"":""address""}],""name"":""CertAdmins"",""outputs"":[{""name"":"""",""type"":""bool""}],""payable"":false,""stateMutability"":""view"",""type"":""function""},{""constant"":false,""inputs"":[{""name"":""_CompanyName"",""type"":""string""},{""name"":""_Norm"",""type"":""string""},{""name"":""_CertID"",""type"":""string""},{""name"":""_issued"",""type"":""uint256""},{""name"":""_expires"",""type"":""uint256""},{""name"":""_Scope"",""type"":""string""},{""name"":""_issuingBody"",""type"":""string""}],""name"":""setCertificate"",""outputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""function""},{""constant"":true,""inputs"":[],""name"":""GlobalAdmin"",""outputs"":[{""name"":"""",""type"":""address""}],""payable"":false,""stateMutability"":""view"",""type"":""function""},{""constant"":false,""inputs"":[{""name"":""_CertID"",""type"":""string""}],""name"":""delCertificate"",""outputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""function""},{""constant"":false,""inputs"":[{""name"":""_CertAdmin"",""type"":""address""}],""name"":""delCertAdmin"",""outputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""function""},{""constant"":true,""inputs"":[{""name"":"""",""type"":""bytes32""}],""name"":""CertificateAddresses"",""outputs"":[{""name"":"""",""type"":""address""}],""payable"":false,""stateMutability"":""view"",""type"":""function""},{""inputs"":[],""payable"":false,""stateMutability"":""nonpayable"",""type"":""constructor""},{""anonymous"":false,""inputs"":[{""indexed"":false,""name"":""_certID"",""type"":""string""},{""indexed"":false,""name"":""_certAdrress"",""type"":""address""}],""name"":""CertificationSet"",""type"":""event""},{""anonymous"":false,""inputs"":[{""indexed"":false,""name"":""_certID"",""type"":""string""},{""indexed"":false,""name"":""_certAdrress"",""type"":""address""}],""name"":""CertificationDeleted"",""type"":""event""},{""anonymous"":false,""inputs"":[{""indexed"":false,""name"":""_certAdmin"",""type"":""address""}],""name"":""CertAdminAdded"",""type"":""event""},{""anonymous"":false,""inputs"":[{""indexed"":false,""name"":""_certAdmin"",""type"":""address""}],""name"":""CertAdminDeleted"",""type"":""event""},{""anonymous"":false,""inputs"":[{""indexed"":false,""name"":""_globalAdmin"",""type"":""address""}],""name"":""GlobalAdminChanged"",""type"":""event""}]";
            var byteCode = "6060604052341561000f57600080fd5b60028054600160a060020a03191633600160a060020a0316179055611221806100396000396000f3006060604052600436106100a35763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630226ed4881146100a85780631536cabf146100c957806325a3ba49146100e8578063520e12d71461014b5780636f3f6870146101b85780639e4a613f146101eb578063a614d54e1461034d578063b96dc96d14610360578063cf904e7d146103b1578063cfe6f220146103d0575b600080fd5b34156100b357600080fd5b6100c7600160a060020a03600435166103e6565b005b34156100d457600080fd5b6100c7600160a060020a0360043516610469565b34156100f357600080fd5b61013960046024813581810190830135806020601f820181900481020160405190810160405281815292919060208401838380828437509496506104eb95505050505050565b60405190815260200160405180910390f35b341561015657600080fd5b61019c60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061057895505050505050565b604051600160a060020a03909116815260200160405180910390f35b34156101c357600080fd5b6101d7600160a060020a03600435166105a6565b604051901515815260200160405180910390f35b34156101f657600080fd5b6100c760046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094968635966020808201359750919550606081019450604090810135860180830194503592508291601f83018190048102019051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405281815292919060208401838380828437509496506105bb95505050505050565b341561035857600080fd5b61019c61091e565b341561036b57600080fd5b6100c760046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061092d95505050505050565b34156103bc57600080fd5b6100c7600160a060020a0360043516610acb565b34156103db57600080fd5b61019c600435610b48565b60025433600160a060020a0390811691161461040157600080fd5b6002805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0383161790557f01998ad4b0cc08b3e190adcb94d72b69479b3f817ea6a2b1fd960ce176610fd981604051600160a060020a03909116815260200160405180910390a150565b60025433600160a060020a0390811691161461048457600080fd5b600160a060020a038116600090815260016020819052604091829020805460ff191690911790557fa4a1a78d5a7a475cc16cdf30cd440485cce5817d6c693dfd725dee060070f89a90829051600160a060020a03909116815260200160405180910390a150565b60006002826000604051602001526040518082805190602001908083835b602083106105285780518252601f199092019160209182019101610509565b6001836020036101000a03801982511681845116808217855250505050505090500191505060206040518083038160008661646e5a03f1151561056a57600080fd5b505060405180519392505050565b6000806000610586846104eb565b8152602081019190915260400160002054600160a060020a031692915050565b60016020526000908152604090205460ff1681565b600160a060020a03331660009081526001602052604081205460ff1615156105e257600080fd5b6105eb866104eb565b9050878787878787876105fc610b63565b80806020018060200180602001888152602001878152602001806020018060200186810386528d818151815260200191508051906020019080838360005b8381101561065257808201518382015260200161063a565b50505050905090810190601f16801561067f5780820380516001836020036101000a031916815260200191505b5086810385528c818151815260200191508051906020019080838360005b838110156106b557808201518382015260200161069d565b50505050905090810190601f1680156106e25780820380516001836020036101000a031916815260200191505b5086810384528b818151815260200191508051906020019080838360005b83811015610718578082015183820152602001610700565b50505050905090810190601f1680156107455780820380516001836020036101000a031916815260200191505b50868103835288818151815260200191508051906020019080838360005b8381101561077b578082015183820152602001610763565b50505050905090810190601f1680156107a85780820380516001836020036101000a031916815260200191505b50868103825287818151815260200191508051906020019080838360005b838110156107de5780820151838201526020016107c6565b50505050905090810190601f16801561080b5780820380516001836020036101000a031916815260200191505b509c50505050505050505050505050604051809103906000f080151561083057600080fd5b60008281526020819052604090819020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0393841617908190557f8fbf148d28be481e097c657015bb6b0208186e51c02513de60d0efa2255ea2a792899291169051600160a060020a038216602082015260408082528190810184818151815260200191508051906020019080838360005b838110156108d95780820151838201526020016108c1565b50505050905090810190601f1680156109065780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15050505050505050565b600254600160a060020a031681565b600160a060020a03331660009081526001602052604081205460ff16151561095457600080fd5b61095d826104eb565b6000818152602081905260409081902054919250600160a060020a039091169063afa936b890518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401600060405180830381600087803b15156109c857600080fd5b6102c65a03f115156109d957600080fd5b50505060008181526020819052604090819020547fd3595dec7c51a76054a222cd6805bb86e35b5f4b1963b9f7eb73beade34426c5918491600160a060020a03169051600160a060020a038216602082015260408082528190810184818151815260200191508051906020019080838360005b83811015610a64578082015183820152602001610a4c565b50505050905090810190601f168015610a915780820380516001836020036101000a031916815260200191505b50935050505060405180910390a16000908152602081905260409020805473ffffffffffffffffffffffffffffffffffffffff1916905550565b60025433600160a060020a03908116911614610ae657600080fd5b600160a060020a03811660009081526001602052604090819020805460ff191690557fd5c7aece2cb58986279bb01fed2a4436ffe2a84c3c057995bf317f9030a7dac390829051600160a060020a03909116815260200160405180910390a150565b600060208190529081526040902054600160a060020a031681565b60405161068280610b748339019056006060604052341561000f57600080fd5b604051610682380380610682833981016040528080518201919060200180518201919060200180518201919060200180519190602001805191906020018051820191906020018051909101905082841061006857600080fd5b60008054600160a060020a03191633600160a060020a031617905560018780516100969291602001906100fd565b5060028680516100aa9291602001906100fd565b5060038580516100be9291602001906100fd565b506004849055600583905560068280516100dc9291602001906100fd565b5060078180516100f09291602001906100fd565b5050505050505050610198565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061013e57805160ff191683800117855561016b565b8280016001018555821561016b579182015b8281111561016b578251825591602001919060010190610150565b5061017792915061017b565b5090565b61019591905b808211156101775760008155600101610181565b90565b6104db806101a76000396000f3006060604052600436106100985763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663218fd1c4811461009d57806331e8c7ba146101275780633eb1eb1a1461013a57806349cf2eae1461014d5780635f1ff54914610189578063a2240eb0146101ae578063afa936b8146101c1578063b1cb0db3146101d6578063f82ec3e6146101e9575b600080fd5b34156100a857600080fd5b6100b06101fc565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ec5780820151838201526020016100d4565b50505050905090810190601f1680156101195780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561013257600080fd5b6100b061029a565b341561014557600080fd5b6100b0610305565b341561015857600080fd5b610160610370565b60405173ffffffffffffffffffffffffffffffffffffffff909116815260200160405180910390f35b341561019457600080fd5b61019c61038c565b60405190815260200160405180910390f35b34156101b957600080fd5b6100b0610392565b34156101cc57600080fd5b6101d46103fd565b005b34156101e157600080fd5b61019c61043e565b34156101f457600080fd5b6100b0610444565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102925780601f1061026757610100808354040283529160200191610292565b820191906000526020600020905b81548152906001019060200180831161027557829003601f168201915b505050505081565b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102925780601f1061026757610100808354040283529160200191610292565b60078054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102925780601f1061026757610100808354040283529160200191610292565b60005473ffffffffffffffffffffffffffffffffffffffff1681565b60045481565b60068054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102925780601f1061026757610100808354040283529160200191610292565b6000543373ffffffffffffffffffffffffffffffffffffffff90811691161461042557600080fd5b3273ffffffffffffffffffffffffffffffffffffffff16ff5b60055481565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102925780601f10610267576101008083540402835291602001916102925600a165627a7a7230582006dc7f4d238ae32f76e57d23ff4d873aa046c0325ba73035e60cc672a7c089300029a165627a7a72305820b522e3f2d56cce6cd7ff7690b4b0b7bc505b1f4552843521ef97a4a429f400c50029";



        //a managed account uses personal_sendTransanction with the given password, this way we don't need to unlock the account for a certain period of time
            var account = new ManagedAccount(senderAddress, password);

        //using the specific geth web3 library to allow us manage the mining.
            var web3 = new Geth.Web3Geth(account);


            var certifierContract = web3.Eth.GetContract(abi, contractAddress);
            Assert.Equal(contractAddress, certifierContract.Address);

        }

   

    }
}
